---

# ğŸ§  Health Guardian Backend â€” API Documentation

This backend provides APIs for conducting cognitive assessment tasks across multiple cognitive domains:

* **Memory (Word List Recall)**
* **Attention (Digit Span)**
* **Executive Function (Stroop Task)**

Each module generates **three structured questions**, logs user performance, and stores results with timestamps for day-to-day comparison.

---

# ğŸ“ Project Structure

```
src/
â”‚
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ games/
â”‚           â”œâ”€â”€ memory/
â”‚           â”‚   â””â”€â”€ wordlist/route.ts
â”‚           â”œâ”€â”€ attention/
â”‚           â”‚   â””â”€â”€ digitspan/route.ts
â”‚           â”œâ”€â”€ executive/
â”‚           â”‚   â””â”€â”€ stroop/route.ts
â”‚           â””â”€â”€ results/route.ts
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ games/
â”‚   â”‚   â”œâ”€â”€ memory.service.ts
â”‚   â”‚   â”œâ”€â”€ attention.service.ts
â”‚   â”‚   â”œâ”€â”€ executive.service.ts
â”‚   â”‚   â””â”€â”€ gameResults.service.ts
â”‚
â”œâ”€â”€ controllers/ (optional)
â”‚
â”œâ”€â”€ repositories/
â”‚   â””â”€â”€ gameResults.repository.ts
â”‚
â”œâ”€â”€ models/
â”‚   â””â”€â”€ gameResult.model.ts
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ gemini.ts
â”‚   â””â”€â”€ response.ts
â”‚
â””â”€â”€ config/
    â””â”€â”€ db.ts
```

---

# âš™ï¸ Requirements

- **Next.js (App Router)**
- **Node.js 18+**
- **MongoDB**
- **Gemini API Key (Google Generative AI)**
  Add to `.env.local`:

```
GEMINI_API_KEY=your_key_here
```

---

# ğŸ”Œ API ENDPOINTS

Below are all available endpoints.

---

# 1. MEMORY: Word List Recall

### **GET /api/games/memory/wordlist**

Generates **3 memory questions**, each containing:

- 8 nouns generated by Gemini
- Recall timing
- Timestamp when recall will happen

### âœ… Response Example

```json
{
  "questions": [
    {
      "id": 1,
      "question": "Remember these words. You will be asked to recall them after 60 seconds.",
      "data": {
        "words": [
          "chair",
          "apple",
          "stone",
          "table",
          "dog",
          "tree",
          "light",
          "glass"
        ]
      },
      "meta": {
        "delaySeconds": 60,
        "scheduledAt": "2025-11-28T14:31:22.123Z"
      }
    },
    { "...": "..." }
  ]
}
```

---

### **POST /api/games/memory/wordlist**

Used when user submits recalled words.

#### Body Example

```json
{
  "userId": "USER_ID",
  "questionId": 2,
  "shownWords": [
    "chair",
    "apple",
    "tree",
    "light",
    "stone",
    "table",
    "dog",
    "glass"
  ],
  "recalledWords": ["chair", "dog", "apple"],
  "reactionTime": 4510
}
```

### Response Example

```json
{
  "result": {
    "accuracy": 0.37,
    "mistakes": ["apple", "stone", "glass"],
    "gameType": "memory_wordlist"
  }
}
```

---

# 2. ATTENTION: Digit Span

### **GET /api/games/attention/digitspan**

Generates **3 digit-span questions**.

### Response Example

```json
{
  "questions": [
    {
      "id": 1,
      "question": "Memorize the digits shown and repeat them in the same order.",
      "data": {
        "digits": [4, 1, 8, 2, 9, 6]
      },
      "meta": {
        "difficulty": "forward",
        "expectedResponse": "repeat in same order"
      }
    }
  ]
}
```

---

### **POST /api/games/attention/digitspan**

#### Body Example

```json
{
  "userId": "USER_ID",
  "questionId": 1,
  "shownDigits": [4, 1, 8, 2, 9, 6],
  "userDigits": [4, 1, 8, 2, 9, 6],
  "reactionTime": 2120
}
```

### Response Example

```json
{
  "result": {
    "accuracy": 1,
    "mistakes": [],
    "gameType": "attention_digitspan"
  }
}
```

---

# 3. EXECUTIVE FUNCTION: Stroop Task

### **GET /api/games/executive/stroop**

Generates **3 Stroop questions** with random word + ink color.

### Response Example

```json
{
  "questions": [
    {
      "id": 1,
      "question": "Select the COLOR of the text, not the word itself.",
      "data": {
        "word": "blue",
        "inkColor": "red"
      },
      "meta": {
        "rule": "choose ink color",
        "interference": true
      }
    }
  ]
}
```

---

### **POST /api/games/executive/stroop**

#### Body Example

```json
{
  "userId": "USER_ID",
  "questionId": 1,
  "word": "blue",
  "inkColor": "red",
  "userAnswer": "red",
  "reactionTime": 1400
}
```

### Response Example

```json
{
  "result": {
    "accuracy": 1,
    "mistakes": [],
    "gameType": "executive_stroop"
  }
}
```

---

# 4. RESULTS: Day-Wise Comparison

### **POST /api/games/results**

Compare results:

- Today
- Yesterday

### Body Example

```json
{
  "userId": "USER_ID",
  "date": "2025-11-28"
}
```

---

### Response Example

```json
{
  "today": [
    {
      "gameType": "memory_wordlist",
      "accuracy": 0.5,
      "timestamp": "2025-11-28T14:20:00Z"
    }
  ],
  "yesterday": [
    {
      "gameType": "attention_digitspan",
      "accuracy": 1,
      "timestamp": "2025-11-27T16:10:00Z"
    }
  ]
}
```

---

# ğŸ—„ Database Model (MongoDB)

### **GameResult Model**

```ts
{
  userId: ObjectId,
  gameType: String,
  inputData: Object,        // shown words / digits / stroop stimulus
  userResponse: Object,     // user's answers
  accuracy: Number,
  reactionTime: Number,
  mistakes: [String],
  timestamp: Date
}
```

---

# ğŸ§ª Postman Testing Summary

### Memory

```
GET  /api/games/memory/wordlist
POST /api/games/memory/wordlist
```

### Digit Span

```
GET  /api/games/attention/digitspan
POST /api/games/attention/digitspan
```

### Stroop

```
GET  /api/games/executive/stroop
POST /api/games/executive/stroop
```

### Results

```
POST /api/games/results
```

---
